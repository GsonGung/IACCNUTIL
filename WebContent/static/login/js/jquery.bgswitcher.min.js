/*!
 * jQuery.BgSwitcher
 *
 * @version  0.4.3
 * @author   rewish <rewish.org@gmail.com>
 * @license  MIT License (https://github.com/rewish/jquery-bgswitcher/blob/master/LICENSE.md)
 * @link     https://github.com/rewish/jquery-bgswitcher
 */
(function(n){"use strict";function t(i){this.$el=n(i),this.index=0,this.config=n.extend({},t.defaultConfig),this._setupBackgroundElement(),this._listenToResize()}var i={},f=Array.prototype.slice,e=Object.prototype.toString,r=["Top","Right","Bottom","Left"],u=["Attachment","Color","Image","Repeat","Position","Size","Clip","Origin"];n.fn.bgswitcher=function(){var r=arguments,i=t.keys.instance;return this.each(function(){var u=n.data(this,i);u||(u=new t(this),n.data(this,i,u)),u.dispatch.apply(u,r)})},n.fn.bgSwitcher=n.fn.bgswitcher,n.extend(t.prototype,{dispatch:function(n){switch(e.call(n)){case"[object Object]":this.setConfig(n);break;case"[object String]":this[n].apply(this,f.call(arguments,1));break;default:throw new Error("Please specify a Object or String");}},setConfig:function(t){this.config=n.extend(this.config,t),typeof this.config.random!="undefined"&&(this.config.shuffle=this.config.random),this.refresh()},setImages:function(n){this.imageList=new this.constructor.ImageList(n),this.config.shuffle&&this.imageList.shuffle()},setSwitchHandler:function(t){this.switchHandler=n.proxy(t,this)},getBuiltInSwitchHandler:function(n){return this.constructor.switchHandlers[n||this.config.effect]},refresh:function(){this.setImages(this.config.images),this.setSwitchHandler(this.getBuiltInSwitchHandler()),this._prepareSwitching(),this.config.start&&this.start()},start:function(){this._timerID||(this._timerID=setTimeout(n.proxy(this,"next"),this.config.interval))},stop:function(){this._timerID&&(clearTimeout(this._timerID),this._timerID=null)},toggle:function(){this._timerID?this.stop():this.start()},reset:function(){this.index=0,this._prepareSwitching()},next:function(){var n=this.imageList.count();(this.config.loop||this.index+1!==n)&&(++this.index===n&&(this.index=0),this.switching())},prev:function(){(this.config.loop||this.index!==0)&&(--this.index==-1&&(this.index=this.imageList.count()-1),this.switching())},select:function(n){n===-1&&(n=this.imageList.count()-1),this.index=n,this.switching()},switching:function(){var n=!!this._timerID;n&&this.stop(),this._createSwitchableElement(),this._prepareSwitching(),this.switchHandler(this.$switchable),n&&this.start()},destroy:function(){this.stop(),this._stopListeningToResize(),this.$switchable&&(this.$switchable.stop(),this.$switchable.remove(),this.$switchable=null),this.$bg&&(this.$bg.remove(),this.$bg=null),this.$el.removeAttr("style"),this.$el.removeData(this.constructor.keys.instance),this.$el=null},_adjustRectangle:function(){for(var n,t=0,f=r.length,u=this.$el.position(),i={top:u.top,left:u.left,width:this.$el.innerWidth(),height:this.$el.innerHeight()};t<f;t++)n=r[t],i["margin"+n]=this.$el.css("margin"+n),i["border"+n]=this.$el.css("border"+n);this.$bg.css(i)},_setupBackgroundElement:function(){this.$bg=n(document.createElement("div")),this.$bg.css({position:"absolute",zIndex:(parseInt(this.$el.css("zIndex"),10)||0)-1,overflow:"hidden"}),this._copyBackgroundStyles(),this._adjustRectangle(),this.$el[0].tagName==="BODY"?this.$el.prepend(this.$bg):(this.$el.before(this.$bg),this.$el.css("background","none"))},_createSwitchableElement:function(){this.$switchable&&this.$switchable.remove(),this.$switchable=this.$bg.clone(),this.$switchable.css({top:0,left:0,margin:0,border:"none"}),this.$switchable.appendTo(this.$bg)},_copyBackgroundStyles:function(){for(var i,n={},r=0,f=u.length,t="backgroundPosition";r<f;r++)i="background"+u[r],n[i]=this.$el.css(i);n[t]===undefined&&(n[t]=[this.$el.css(t+"X"),this.$el.css(t+"Y")].join(" ")),this.$bg.css(n)},_listenToResize:function(){var t=this;this._resizeHandler=function(){t._adjustRectangle()};n(window).on("resize",this._resizeHandler)},_stopListeningToResize:function(){n(window).off("resize",this._resizeHandler),this._resizeHandler=null},_prepareSwitching:function(){this.$bg.css("backgroundImage",this.imageList.url(this.index)),n("#bgslideol li").removeClass("active"),n("#bgslideol li").eq(this.index).addClass("active")}}),t.keys={instance:"bgSwitcher"},t.defaultConfig={images:[],interval:5e3,start:!0,loop:!0,shuffle:!1,effect:"fade",duration:1e3,easing:"swing"},t.switchHandlers={fade:function(n){n.animate({opacity:0},this.config.duration,this.config.easing)},blind:function(n){n.animate({height:0},this.config.duration,this.config.easing)},clip:function(n){n.animate({top:parseInt(n.css("top"),10)+n.height()/2,height:0},this.config.duration,this.config.easing)},slide:function(n){n.animate({top:-n.height()},this.config.duration,this.config.easing)},drop:function(n){n.animate({left:-n.width(),opacity:0},this.config.duration,this.config.easing)},hide:function(n){n.hide()}},t.defineEffect=function(n,t){this.switchHandlers[n]=t},t.ImageList=function(n){this.images=n,this.createImagesBySequence(),this.preload()},n.extend(t.ImageList.prototype,{isSequenceable:function(){return typeof this.images[0]=="string"&&typeof this.images[1]=="number"&&typeof this.images[2]=="number"},createImagesBySequence:function(){if(this.isSequenceable()){var n=[],i=this.images[0],t=this.images[1],r=this.images[2];do n.push(i.replace(/\.\w+$/,t+"$&"));while(++t<=r);this.images=n}},preload:function(){for(var n,r=this.images.length,t=0;t<r;t++)n=this.images[t],i[n]||(i[n]=new Image,i[n].src=n)},shuffle:function(){var t,i,n=this.images.length,r=this.images.join();if(n){while(n)t=Math.floor(Math.random()*n),i=this.images[--n],this.images[n]=this.images[t],this.images[t]=i;this.images.join()===r&&this.shuffle()}},get:function(n){return this.images[n]},url:function(n){return"url("+this.get(n)+")"},count:function(){return this.images.length}}),n.BgSwitcher=t})(jQuery)